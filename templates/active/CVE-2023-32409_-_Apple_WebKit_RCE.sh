AUTHOR='@xer0dayz'
VULN_NAME='CVE-2023-32409 - Apple Multiple Devices WebKit RCE'
URI="/exploit.html"
METHOD='GET'
MATCH='<script>alert(document.cookie)</script>'
SEVERITY='P1 - CRITICAL'
CURL_OPTS="--user-agent 'Mozilla/5.0 (iPhone; CPU iPhone OS 16_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.5 Mobile/15E148 Safari/604.1' -s --insecure -L"
SECONDARY_COMMANDS='''
# Check for vulnerable WebKit version
VERSION_CHECK=$(curl -s -I -A "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.5 Safari/605.1.15" https://www.apple.com | grep -i '^server:' | grep -oP 'AppleWebKit/\K[^\s]+')
if [ -n "$VERSION_CHECK" ]; then
    echo -e "\n[+] Detected WebKit Version: $VERSION_CHECK"
    echo "[*] Versions before Safari 16.5.1, iOS 16.5.1, iPadOS 16.5.1, and macOS Ventura 13.4.1 are vulnerable"
fi
'''

# This vulnerability allows remote code execution when processing maliciously crafted web content
